<html>
<head>
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
	<title>Dynamic Notifications</title>
</head>
<body>
	<a href = "index.html">HOME PAGE</a>
	<h1>Dynamic Notifications</h1>
	<p>Dynamic Notifications are useful to alert the user when an element on-screen has been added, deleted, or somehow changed due to a user's action.</p>
	<h3>When to Use Dynamic Notifications</h3>
	<p>When sighted users use an application, they can visually obtain information about on-screen changes. Non-sighted users, however, need an aural clue so that they can better understand what is on-screen to navigate the app more easily.  There are many scenarios in which Dynamic Notifications are essential to creating an accessible application.  One common example is when a user presses a button.  If the button changes an element (such as a dynamic image), it may be important to have VoiceOver focus on it and announce how the item changed.  If the button adds or deletes an element (such as the example below), VoiceOver could announce what was added or deleted.</p>
	<p>However, be careful not to add too many notifications! It is important to have a good balance. The user should be notified and up-to-date, but not overloaded with audible notifications.  Too many notifications can become disruptive and make the app even more inaccessible.  More about this can be seen under "Finding the Balance" in <a href = "DQUUpdatingContent.html">Updating Content</a>.</p>
	<h3>Implementing Dynamic Notifications</h3>
	<p>To add a VoiceOver notification, simply use the following line of code in a function call:
		<blockquote><pre class = "prettyprint"><code>UIAccessibilityPostNotification(UIAccessibilityNotification, UIObject);</code></pre></blockquote>
	where <code>UIAccessibilityNotification</code> is one of the many notifications listed <a href = "http://developer.apple.com/library/ios/documentation/UIKit/Reference/UIAccessibility_Protocol/">here</a>, and <code>UIObject</code> is either a <code>UIView</code> or an <code>NSString</code>.  Each UIAccessibility Notification has a different purpose.  The most commonly-used ones are listed below.</p>
	<h4><i>UIAccessibilityAnnouncementNotification</i></h4>
	<p>UIAccessibilityAnnouncementNotifications are useful if you need VoiceOver to read out a custom announcement.  To use this type of notification, copy and paste the above code, and replace <code>UIAccessibilityNotification</code> with <code>UIAccessibilityAnnouncementNotification</code> and <code>UIObject</code> with an <code>NSString</code> of the announcement you would like to have read out.
	<h4><i>UIAccessibilityLayoutChangedNotification</i></h4>
	<p>UIAccessibilityLayoutChangedNotifications are useful when an element has been added or changed and needs to be focused on.  This is typically used for changes that take up a small portion of the screen.  To use this notification, use the <code>UIAccessibilityPostNotification</code> function listed above, and replace <code>UIAccessibilityNotification</code> with <code>UIAccessibilityLayoutChangedNotification</code> and <code>UIObject</code> with a <code>UIView</code> (such as an image, a button, or a textfield).  You can also use an <code>NSString</code> if you would like VoiceOver to announce a custom string.  Note that using an <code>NSString</code> with this notification may be buggy in iOS 8.3 and prior.
	<h4><i>UIAccessibilityScreenChangedNotification</i></h4>
	<p><code>UIAccessibilityScreenChangedNotification</code> is similar to <code>UIAccessibilityLayoutNotification</code> in that it is useful to force VoiceOver to focus on an element; however, this should only be used if a major portion of the screen changed.  This notification can be helpful to make VoiceOver focus on a modal dialog.  To use this in your code, use the <code>UIAccessibilityPostNotification</code> function listed above, and replace <code>UIAccessibilityNotification</code> with <code>UIAccessibilityScreenChangedNotification</code> and <code>UIObject</code> with a <code>UIView</code>.  You can also use an <code>NSString</code> if you would prefer to have VoiceOver read out a custom announcement to the user.  
	<h3>Dynamic Notifications Example</h3>
	<p>Below is an example of a simple list interface.  To a sighted user, this interface is intuitive - tap "Save" to save a contact and tap "Clear Contacts" to delete the entire contents of the list.  If the textfield is not empty and "save" is pressed, a sighted user can see that the name was successfully saved, and similarly with "Clear Contacts."  However, what about to a non-sighted user?  How can a non-sighted user receive clues about what happened when "Save" or "Clear Contacts" was pressed?  When a VoiceOver user taps the "Save" button, by default, VoiceOver only announces "Save."  There is no indication of what was saved or even if the save was successful or not.  Similarly, when a VoiceOver user taps the "Clear Contacts" button, VoiceOver only announces "Clear Contacts."  This is where Dynamic Notifications come into play!</p>
	<img src = "Images/DQUDynamicNotificationsInterface.png" alt = "Image of a list titled 'Contacts' with 'Save' button that saves a contact, and a 'Clear Contacts' button that clears the list">
	<h4><i>After "Clear Contacts" is Pressed</i></h4>
	<p>When "Clear Contacts" is pressed, the function <code>(NSString*)clearList</code> is called.  <code>clearList</code> deletes every contact in the contact list, and calls <code>UIAccessibilityPostNotification</code> to alert the VoiceOver user whether the list was successfully deleted.  The function's code is below.</p>
	<blockquote><pre class = "prettyprint"><code>- (NSString*)clearList {
	NSString* announcement;

	//Creates announcement for if the list was cleared when clearContacts button was pressed.
	if([_contactList count] == 0) {
		announcement = NSLocalizedString(@"NO_CONTACTS", nil);
	} else {
		announcement = NSLocalizedString(@"CONTACTS_DELETED", nil);
	}

	[_contactList removeAllObjects];
	[self._tableView reloadData];
	[DQUtilities createDynamicNotification:announcement]; // Prompts VoiceOver to announce the change in the list.

	return announcement;
}</code></pre></blockquote>
	<p>Notice how first, the function takes into account whether the contact list is empty or not.  It then creates an announcement with the localized string "NO_CONTACTS" or "CONTACTS_DELETED," depending on the context.  (A localized string is a string placed into the "Localizable.strings" file, so that in case your app gets translated, all programmatically defined strings can be easily found in one file.)  "NO_CONTACTS", in the Localizable.strings file, is defined as "Contact list empty - no contacts deleted," and "CONTACTS_DELETED" is defined as "Contacts have been deleted."  So, <code>NSString announcement</code> is assigned to either "Contact list empty - no contacts deleted" or "Contacts have been deleted."  This <code>NSString</code> then gets passed to the function <code>createDynamicNotification</code>.  Below is the code for <code>createDynamicNotification</code>.</p>
	<blockquote><pre class = "prettyprint"><code>+ (void)createDynamicNotification:(NSString*)announcement {
	dispatch_after(dispatch_time(DISPATCH_TIME_NOW, NSEC_PER_SEC), dispatch_get_main_queue(), ^{
		UIAccessibilityPostNotification(UIAccessibilityAnnouncementNotification, announcement);
	});
}</code></pre></blockquote>
	<p><code>createDynamicNotification</code> calls <code>UIAccessibilityPostNotification</code>, which has its first parameter defined as <code>UIAccessibilityAnnouncementNotification</code>.  <code>createDynamicNotification</code> calls <code>dispatch_time</code>, a time delay function, to ensure that the notification will be posted by VoiceOver.  This way, when "Clear Contacts" is pressed, our notification of "Contacts have been deleted" is not interrupted by VoiceOver's "Clear Contacts" statement.  So, when "Clear Contacts" is pressed, if the contact list is empty, the VoiceOver user will be alerted that no contacts were deleted because the list is empty.  If the contact list is not empty, the VoiceOver user will be alerted that contacts were successfully deleted.</p>
	<h4><i>After "Save" is Pressed</i></h4>
	<p>The "Save" button is implemented in a similar fashion.  When "Save" is pressed, the function <code>saveItem</code> is called, which contains <code>UIAccessibilityPostNotification</code>.  <code>saveItem</code> checks if the textfield is empty, and if it is, it notifies VoiceOver to post "Textfield empty - no name added to contacts." If the textfield is not empty, VoiceOver posts "<i>Item</i> was added to contacts," where <i>Item</i> is the text that was written in the textfield.  <code>saveItem</code> then clears the textfield, removes the keyboard, and adds the contact to the list.</p>
	<p>If you would like to see full code for this example, it can be found <a href = "https://github.com/dequelabs/Deque-University-for-iOS/blob/master/DequeU/Basic%20Demos/Dynamic%20Notifications/IACDynamicNotificationsFixedViewController.m">on Github</a>.</p>
	<h3>Tips</h3>
	<ul>
		<li>Do not use the <code>UIAccessibilityLayoutChangedNotification</code> to announce NSStrings, for it may not work.  It is known to be buggy.</li>
		<li>Have enough notifications to make sure that your users will understand when something changes, but do not have so many such that it clogs VoiceOver with notifications and makes your app unusable.</li>
		<li>When using <code>UIAccessibilityAnnouncementNotification</code>, or any notification to announce NSStrings, limit your notification to at most a sentence.  Keep it short and informative!</li>
	</ul>
	<p>We hope you found this tutorial useful!  Check out our other <a href = "index.html">blog posts</a> and our <a href = "https://github.com/dequelabs/Deque-University-for-iOS">Deque University for iOS app</a> for more accessibility tutorials!</p>
</body>
</html>
