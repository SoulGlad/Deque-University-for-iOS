<html>
<head>
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
	<title>Form Validation</title>
</head>
<body>
	<a href = "index.html">COUNTRY ROADS TAKE ME HOME</a>
	<h1>Form Validation</h1>
	<p>A demo of a native iOS form marked up for accessiblity.</p>
	<h3>Accessible Form Validation</h3>
	<p>Forms, such as login screens, are typically on the first page that a user sees. Most apps that involve a form don't want the requirement errors, frequently highlighted in red, to be messing up the visual appearance of their apps. Instead, specific requirements are denoted by asterisks, hint text, or nothing at all (and are just assumed). Only when users fail to make this assumption are they assaulted with error messages and bright red text. From a sighted user's point of view, this user experience is fine; however, from an accessibility point of view, two critical requirements have been broken. First, the addition of dynamic content (the error labels) means that the errors may not be announced by VoiceOver.  Second, the red color of the error labels conveys information that is not otherwise shown; thus, it is not obvious for non-sighted users that they are error messages.  The goal of this post is to cover how to make these form interfaces accessible, while still keeping the overall original design.</p>
	<h3>Pre Submission</h3>
	<p>Before we submit this form, we have the following setup:</p>
	<img src="Images/DQUFormValidationPreSubmit.PNG" alt="A screenshot of an iOS Application with a basic form prior to submission.  Deque Logo at the top, with 3 text fields for name, email address and date.  A submit button at the bottom.">
	<p>There are several things to notice about this basic form that may be different than the typical iOS form.</p>
	<h4><i>Color Contrast</i></h4>
	<p>One of the first things that may catch your eye is the light blue background of the textfields.  The traditional thin rounded border is difficult for users with mild sight impairments to see.  By providing UITextFields with a light blue background, we ensure the bounds are easy to spot.</p>
	<h4><i>Accessibility Labels and Hints</i></h4>
	<p>Below is a screenshot of the Storyboard Editor with a UIView selected (boxed off with a thin black rectangle to see its bounds easier).  This UIView contains the "Name" label and a textfield.  The accessibility section of the Identity Inspector for the UIView is also pictured below (the area boxed off in red).  Notice that the Accessibility Label for this element is "Name, Text Field" and the Accessibility Hint is "This field is required."  If the VoiceOver user focuses on this view, he will hear, "Name, Text Field. (pause) This field is required."  The pause always occurs between Accessibility Labels and Accessibility Hints.  When setting up accessibility for applications, always keep two users in mind: power users and new users. Labels provide instant, important information that even the users most familiar with your application need to orient themselves; however, the information in a hint, such as "this field is required", is something that new users to your application will need to know.  They will become accustomed to your app over time and will not always need these hints.</p>
	<img src = "Images/DQUFormValidationLabels.png" alt = "Image of the Accessibility section of the Identity Inspector in XCode. The 'Label' field says 'Name, TextField' and 'Hint' says 'This field is required.'">
	<p>In addition, the Date field is marked up differently than the Email or Name fields.  It has a more complex requirement - the mm/dd/yyyy date formatting. A popular approach is to replicate the Android "Hint" text, where we place the formatting requirements directly into the UITextField as placeholder text; however, this placeholder text will ultimately be replaced when the user types into the text field.  So a UITextField that was first read out as "Date, mm/dd/yyyy", then becomes read out as "Date, '(entered text).'"  For sighted users, this information is commonly available elsewhere on the app, but for non-sighted users, it is frequently lost for good. We remedy this situation by separating the two labels for sighted and non-sighted users.  We place an extra label with the text "mm/dd/yyyy" underneath the UITextField for sighted users.  We then set the Accessibility Label for the UIView containing the Date label and the textfield to be "Date m m / d d / y y y y" so that VoiceOver users can always reference the required formatting of the date.  The extra spaces in the Accessibility Label cause VoiceOver to readout the letters more concisely.  Without it, individual letters aren't pronounced well.  More information about Accessibility Labels and Hints can be found <a href = "DQUAccessibilityLabels.html">here</a>.</p>
	<h4><i>Wrapper Views</i></h4>
	<p>You may have noticed that we have been placing Accessibility Labels and Hints onto UIViews instead of the textfields themselves.  This is to help VoiceOver users navigate the app more easily.  If we did not group similar elements together with UIViews, we would have a "Date" label, a textfield, and a "mm/dd/yyyy" label.  A VoiceOver user would tab over to the "Date" label, hear "Date", then tab over to the textfield and hear "Textfield.  Double-tap to edit."  The VoiceOver user could then tab over to the "mm/dd/yyyy" label, and only hear "mm/dd/yyyy."  There is no clear indication that the Date label corresponds to the textfield, or that the "mm/dd/yyyy" label describes the required formatting for inputting the date.  To fix this, simply group everything into a UIView, set the view as an accessibility element, and change the Accessibility Label and Accessibility Hint of the UIView itself with essential information, instead of each individual element.  Note that this only works effectively if one element in the UIView is not static.  If there is more than one textfield, or a textfield and one switch, in one accessible view, neither element will be able to be focused when VoiceOver is turned on.</p>
	<h3>Post Submission</h3>
	<p>Here is what the view looks like after we attempt to submit the form, without anything filled out:</p>
	<img src="Images/PostSubmit.PNG" alt="An image of an iOS View, the same view as in the other image, but after unsuccessful form submission.  Deque logo at the top, with three text entry fields, denoting space for name, email address, and date.  There are error messages in red text below each field, because the text fields were left empty.">
	<p>From a visual standpoint, things have changed. We now see error messages below the UITextFields; however, what is more important is what happens with VoiceOver turned on.</p>
	<h4><i>Accessibility Labels and Hints</i></h4>
	<p>After submission, if requirements are not met, the Accessibility Hint text gets added to the Accessibility Label to make VoiceOver users aware that there are unmet requirements on those fields.  If the hint text was ignored before, it is now more difficult to ignore!  Note that the actual statement "This field is required" has not changed. Changing the content of the text would be jarring, so we are just placing the text elsewhere to make it more obvious. This subtle change also hints to which fields need to be revisited. If requirement messages are attached only to labels for fields that weren't correctly filled out, and otherwise left unchanged, it provides clues as to which fields are problematic.</p>
	<h4><i>VoiceOver Notifications</i></h4>
	<p>Finally, we want VoiceOver to focus onto the first element that failed validation.  In the case shown above, the first element focused would be the wrapper view containing the Name field.  If a name were provided when the "submit" button was pressed, VoiceOver would focus on the Email wrapper view. We can programmatically change VoiceOver's focus by using the following function:
		<blockquote><pre class = "prettyprint"><code>UIAccessibilityPostNotification(UIAccessibilityLayoutChangedNotification, _nameField);</code></pre></blockquote>
	This notification tells VoiceOver to send its accessibilityFocus to the Name wrapper view.  When focus changes, the label of the new element is read out (but not the hint), and the black VoiceOver box is moved to the element. We move it to the first failing element so that as the user flips forward through the remaining items, they will easily find the other items that have failed.  More information about <code>UIAccessibilityPostNotification</code> can be found in the section "Implementation of Dynamic Notifications," found in <a href = "DQUDynamicNotifications.html">this blog post</a>.</p>
	<h3>Alternate Design Decisions</h3>
	<p>There are a few other ways we could have implemented this form so that it is accessible.  The following discusses these design decisions, and why we chose this as the "best" way.</p>
	<h4><i>Layout Notification Bug</i></h4>
	<p>One of the possible ways to handle dynamic content, such as form error validation, is to announce that content has been added to the page. In fact, iOS supports such notifications. Instead of supplying a UIObject to the post notification call, we could have used
		<blockquote><pre class = "prettyprint"><code>UIAccessibilityPostNotification(UIAccessibilityLayoutChangedNotification, @"Form submission failed, check ##### element");</code></pre></blockquote>
	This should then cause VoiceOver to announce the provided string. However, this behavior is bugged in at least iOS 8.3 and prior. So this approach may not work as the best solution. We could instead use the screen changed notification:
	<blockquote><pre class = "prettyprint"><code>UIAccessibilityPostNotification(UIAccessibilityScreenChangedNotification, @"Form submission failed, check ##### element");</code></pre></blockquote>
	It provides a similar behavior, but is not bugged.  The screen changed notification, however, adds an extra sound effect to let the VoiceOver user know that the screen has changed.  This, therefore, would be a misleading representation of what has happened.  Ultimately a combination of the two solutions would be best, but given the current framework bugs, we believe our solution has a good balance.</p>
	<h4><i>Leave Info in the Hint</i></h4>
	<p>Another alternative would be to leave the accessibility information alone. Instead of moving the AccessibilityHint information into the AccessibilityLabel, just leave it be!  This is a reasonable solution, except for one little flaw. When you use the <code>UIAccessibilityLayoutChangedNotification</code> to move focus to the first failing element, only the AccessibilityLabel for that element is read out, so the "This field is required" portion would be left off.  If what we aim to do is draw attention to the errors, then this is not ideal.</p>
	<p>Thanks for reading! If you're interested in learning more about accessibility, check out our other <a href="index.html">blog posts here</a>!</p>
	<p>This discussion frequently references code in the <a href = "https://github.com/dequelabs/Deque-University-for-iOS">open source repository</a> for the Deque University for iOS app. Note that the information from this post was gathered using an iPad (8.3) and iPod Touch (8.3). If any mentioned behaviors/bugs have changed, feel free to leave a comment and we will update as necessary.</p>
</body>
</html>
